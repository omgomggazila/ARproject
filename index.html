<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARç”Ÿæ…‹æ¢éšªï¼šå½±ç‰‡æ•™è‚²ç‰ˆ</title>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; }
        #ui-layer { position: fixed; top: 10px; left: 10px; z-index: 1000; background: rgba(0,0,0,0.8); color: white; padding: 12px; border-radius: 8px; font-size: 16px; }
        #quiz-box { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); z-index: 1001; background: white; padding: 25px; border-radius: 15px; display: none; width: 85%; max-width: 350px; text-align: center; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .ans-btn { background: #2c3e50; color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; margin: 8px 0; width: 100%; font-size: 16px; }
        #result-msg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); color: white; display: none; z-index: 1002; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; }
    </style>
</head>
<body>

<div id="ui-layer">
    <div style="color:#4CAF50">æˆ‘çš„åˆ†æ•¸ï¼š<span id="score-me">0</span></div>
    <div style="color:#FF5252">å°æ‰‹åˆ†æ•¸ï¼š<span id="score-opp">100</span></div>
    <div style="font-size:12px; margin-top:5px;">ç‹€æ…‹ï¼šæƒæå¡ç‰Œè§€çœ‹å½±ç‰‡</div>
</div>

<div id="quiz-box">
    <h3 id="card-title" style="margin-top:0; color:#2c3e50"></h3>
    <p id="question-text" style="color:#333; line-height:1.6"></p>
    <div id="options-area"></div>
</div>

<div id="result-msg">
    <h2 id="feedback-title"></h2>
    <p id="feedback-body" style="font-size: 18px;"></p>
    <button class="ans-btn" style="width:150px" onclick="closeFeedback()">ç¹¼çºŒæŒ‘æˆ°</button>
</div>

<a-scene mindar-image="imageTargetSrc: ./targets.mind;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    <a-assets>
        <video id="v0" src="./videos/v0.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v1" src="./videos/v1.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v2" src="./videos/v2.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v3" src="./videos/v3.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v4" src="./videos/v4.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v5" src="./videos/v5.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v6" src="./videos/v6.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v7" src="./videos/v7.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v8" src="./videos/v8.mp4" loop="false" crossorigin="anonymous"></video>
        <video id="v9" src="./videos/v9.mp4" loop="false" crossorigin="anonymous"></video>
    </a-assets>

    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>

    <script>
        const scene = document.querySelector('a-scene');
        for (let i = 0; i < 10; i++) {
            const target = document.createElement('a-entity');
            target.setAttribute('mindar-image-target', `targetIndex: ${i}`);
            target.id = `marker${i}`;
            
            // å½±ç‰‡é¡¯ç¤ºå¹³é¢
            const videoPlane = document.createElement('a-video');
            videoPlane.setAttribute('src', `#v${i}`);
            videoPlane.setAttribute('width', '1');
            videoPlane.setAttribute('height', '0.75');
            videoPlane.setAttribute('position', '0 0 0');
            
            target.appendChild(videoPlane);
            scene.appendChild(target);
        }
    </script>
</a-scene>

<script>
    let myScore = 0, oppScore = 100, isLocked = false;

    // éš¨æ©Ÿé¡Œç›®æ± è³‡æ–™ (æ¯å¼µå¡ç‰Œ 3 é¡Œ)
    const quizData = [
        { name: "éåº¦æ•æ’ˆ", type: "D", q: ["åº•æ‹–ç¶²æœƒç ´å£æµ·åº•æ£²åœ°å—ï¼Ÿ", "æ•ç²å¹¼é­šæœƒå°è‡´æ—ç¾¤æ¯ç«­å—ï¼Ÿ", "é­šé¡æ¸›å°‘æœƒç ´å£é£Ÿç‰©éˆå—ï¼Ÿ"] },
        { name: "æ¿«ç æ¿«ä¼", type: "D", q: ["æ£®æ—æ¶ˆå¤±æœƒå¢åŠ äºŒæ°§åŒ–ç¢³å—ï¼Ÿ", "æ¨¹æœ¨èƒ½é˜²æ­¢åœŸçŸ³æµå—ï¼Ÿ", "ä¼æœ¨æœƒå°è‡´ç”Ÿç‰©å¤±å»å®¶åœ’å—ï¼Ÿ"] },
        { name: "å·¥æ¥­æ±¡æŸ“", type: "D", q: ["å»¢æ°´æ’å…¥æ²³ä¸­æœƒæ®ºæ­»é­šé¡å—ï¼Ÿ", "é‡é‡‘å±¬æœƒç¶“é£Ÿç‰©éˆç´¯ç©å—ï¼Ÿ", "æ±¡æŸ“æœƒå°è‡´æ°´æºç„¡æ³•é£²ç”¨å—ï¼Ÿ"] },
        { name: "å¤–ä¾†ç¨®å…¥ä¾µ", type: "D", q: ["å¤–ä¾†ç¨®æœƒæ¶å¥ªæœ¬åœŸç¨®é£Ÿç‰©å—ï¼Ÿ", "å¤–ä¾†ç¨®æœƒå› ç„¡å¤©æ•µéåº¦ç¹æ®–å—ï¼Ÿ", "éš¨æ„æ”¾ç”Ÿæœƒç ´å£å¹³è¡¡å—ï¼Ÿ"] },
        { name: "æ°£å€™è®Šé·", type: "D", q: ["æ°£æº«ä¸Šå‡æœƒå°è‡´å†°å±±èåŒ–å—ï¼Ÿ", "æ¥µç«¯æ°£å€™æœƒå½±éŸ¿ä½œç‰©ç”Ÿé•·å—ï¼Ÿ", "æµ·æ´‹è®Šæš–æœƒå°è‡´çŠç‘šç™½åŒ–å—ï¼Ÿ"] },
        { name: "æ£²åœ°å¾©è‚²", type: "C", q: ["ç¨®æ¤åŸç”Ÿæ¤ç‰©èƒ½æ¢å¾©ç”Ÿæ…‹å—ï¼Ÿ", "å»ºç«‹ç”Ÿæ…‹å»Šé“èƒ½å¹«åŠ©é·å¾™å—ï¼Ÿ", "æ¿•åœ°å¾©è‚²èƒ½éæ¿¾æ°´è³ªå—ï¼Ÿ"] },
        { name: "è³‡æºå›æ”¶", type: "C", q: ["å›æ”¶èƒ½æ¸›å°‘å»¢æ£„ç‰©é€²æµ·æ´‹å—ï¼Ÿ", "æ¸›å°‘å¡‘è† èƒ½ä¿è­·æµ·é¾œå—ï¼Ÿ", "å›æ”¶é‡‘å±¬èƒ½æ¸›å°‘ç¤¦ç”¢é–‹ç™¼å—ï¼Ÿ"] },
        { name: "å†ç”Ÿèƒ½æº", type: "C", q: ["é¢¨åŠ›ç™¼é›»èƒ½æ¸›å°‘ç¢³æ’æ”¾å—ï¼Ÿ", "å¤ªé™½èƒ½æ˜¯æ°¸çºŒçš„èƒ½æºå—ï¼Ÿ", "ç¶ èƒ½èƒ½æ¸›ç·©å…¨çƒæš–åŒ–å—ï¼Ÿ"] },
        { name: "ç”Ÿç‰©å¤šæ¨£æ€§", type: "C", q: ["ç‰©ç¨®è¶Šå¤šç”Ÿæ…‹ç³»çµ±è¶Šç©©å®šå—ï¼Ÿ", "æ¯ç¨®ç‰©ç¨®éƒ½æœ‰å…¶åŠŸèƒ½å—ï¼Ÿ", "å¤šæ¨£æ€§é«˜èƒ½æå‡æŠ—ç—…åŠ›å—ï¼Ÿ"] },
        { name: "æ°´è³‡æºä¿è­·", type: "C", q: ["ç¯€ç´„ç”¨æ°´èƒ½ä¿è­·æ·¡æ°´ç”Ÿæ…‹å—ï¼Ÿ", "æ¸›å°‘åŒ–å­¸æ´—åŠ‘èƒ½ä¿è­·æ°´æºå—ï¼Ÿ", "ä¿è­·æ£®æ—èƒ½æ¶µé¤Šæ°´æºå—ï¼Ÿ"] }
    ];

    // ç¶å®šæƒæäº‹ä»¶
    for (let i = 0; i < 10; i++) {
        const marker = document.getElementById(`marker${i}`);
        const video = document.getElementById(`v${i}`);

        marker.addEventListener("targetFound", () => {
            if (!isLocked) {
                video.play(); // é–‹å§‹æ’­æ”¾å½±ç‰‡
                // å½±ç‰‡æ’­æ”¾ 5 ç§’å¾Œå½ˆå‡ºé¡Œç›® (æˆ–æ ¹æ“šå½±ç‰‡é•·åº¦èª¿æ•´)
                setTimeout(() => { if(!isLocked) startQuiz(i); }, 5000);
            }
        });

        marker.addEventListener("targetLost", () => {
            video.pause();
        });
    }

    function startQuiz(id) {
        isLocked = true;
        const card = quizData[id];
        const randomQ = card.q[Math.floor(Math.random() * card.q.length)];
        
        document.getElementById('quiz-box').style.display = 'block';
        document.getElementById('card-title').innerText = card.name;
        document.getElementById('question-text').innerText = randomQ;
        
        const area = document.getElementById('options-area');
        area.innerHTML = '';
        ["æ˜¯ / å¯ä»¥", "å¦ / ä¸å¯ä»¥"].forEach((txt, idx) => {
            const btn = document.createElement('button');
            btn.className = 'ans-btn';
            btn.innerText = txt;
            btn.onclick = () => checkAns(idx === 0, card.type);
            area.appendChild(btn);
        });
    }

    function checkAns(correct, type) {
        let title = "", body = "";
        if (type === "D") { // ç ´å£å¡
            if (correct) { 
                title = "ğŸ‰ ç­”å°äº†ï¼"; 
                body = "ä½ æˆåŠŸæ­ç™¼ç’°å¢ƒå•é¡Œï¼Œå°æ‰‹æ‰£ 10 åˆ†ï¼"; 
                oppScore -= 10; 
            } else { 
                title = "âŒ ç­”éŒ¯äº†ï¼"; 
                body = "æ²’èƒ½é˜»æ­¢ç ´å£ï¼Œæ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œæ˜¯ã€ã€‚è‡ªå·±æ‰£ 10 åˆ†"; 
                myScore -= 10; 
            }
        } else { // ä¿è‚²å¡
            if (correct) { 
                title = "ğŸŒ¿ ç­”å°äº†ï¼"; 
                body = "ä½ å®Œæˆäº†ç”Ÿæ…‹ä¿è­·è¡Œå‹•ï¼Œè‡ªå·±åŠ  10 åˆ†ï¼"; 
                myScore += 10; 
            } else { 
                title = "âŒ ç­”éŒ¯äº†ï¼"; 
                body = "ä¿è‚²å¤±æ•—ï¼Œå†æ¥å†å²ã€‚æ­£ç¢ºç­”æ¡ˆæ˜¯ã€Œæ˜¯ã€"; 
            }
        }
        
        document.getElementById('score-me').innerText = myScore;
        document.getElementById('score-opp').innerText = oppScore;
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('feedback-title').innerText = title;
        document.getElementById('feedback-body').innerText = body;
        document.getElementById('result-msg').style.display = 'flex';
    }

    function closeFeedback() {
        document.getElementById('result-msg').style.display = 'none';
        // 5ç§’å†·å»æ™‚é–“é¿å…é‡è¤‡è§¸ç™¼åŒä¸€å¼µå¡
        setTimeout(() => { isLocked = false; }, 5000);
    }
</script>
</body>
</html>