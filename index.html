<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ARç”Ÿæ…‹æ¢éšªï¼šç’°å¢ƒä¿è‚²æ•™è‚²æ¡ŒéŠç³»çµ±</title>
    
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.2/dist/mindar-image-aframe.prod.js"></script>
    
    <style>
        body { margin: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background-color: #000; user-select: none; }
        .btn { border: none; border-radius: 50px; cursor: pointer; transition: 0.2s; font-weight: bold; box-shadow: 0 4px 10px rgba(0,0,0,0.3); }
        .btn:active { transform: scale(0.95); }

        #home-screen {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #141E30 0%, #243B55 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 2000; color: white; text-align: center;
        }
        
        #team-select-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 2100;
            flex-direction: column; justify-content: center; align-items: center; color: white;
        }

        .team-btn { width: 200px; padding: 20px; margin: 15px; font-size: 24px; color: white; }
        .btn-blue { background: linear-gradient(90deg, #4b6cb7 0%, #182848 100%); border: 2px solid #89a5e6; }
        .btn-red { background: linear-gradient(90deg, #D31027 0%, #EA384D 100%); border: 2px solid #ff8a95; }

        /* éŠæˆ²èªªæ˜å½ˆçª—å„ªåŒ– */
        #instruction-modal {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            width: 90%; max-width: 500px; height: 80vh; overflow-y: auto;
            background: white; color: #333; padding: 25px; border-radius: 15px; 
            display: none; z-index: 3000; box-shadow: 0 10px 30px rgba(0,0,0,0.5); text-align: left;
        }
        #instruction-modal h3 { text-align: center; color: #2c3e50; margin-top: 0; }
        #instruction-modal b { color: #d31027; }

        #ui-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; display: none; z-index: 1000; }
        .score-board {
            position: absolute; top: 15px; padding: 10px 20px; border-radius: 10px;
            color: white; font-size: 18px; font-weight: bold;
            display: flex; flex-direction: column; align-items: center;
        }
        #score-blue-box { left: 15px; background: rgba(20, 50, 100, 0.8); border-left: 5px solid #4b6cb7; }
        #score-red-box { right: 15px; background: rgba(100, 20, 20, 0.8); border-right: 5px solid #D31027; }
        .big-score { font-size: 28px; }

        #turn-banner {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            padding: 10px 40px; border-radius: 30px;
            font-size: 20px; color: white; font-weight: bold;
            box-shadow: 0 0 20px rgba(255,255,255,0.2);
            transition: background 0.5s;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: translateX(-50%) scale(1); } 50% { transform: translateX(-50%) scale(1.05); } 100% { transform: translateX(-50%) scale(1); } }

        #control-panel { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); display: flex; gap: 15px; pointer-events: auto; }
        .ctrl-btn { padding: 10px 20px; font-size: 16px; color: white; border-radius: 30px; border: 2px solid rgba(255,255,255,0.5); backdrop-filter: blur(5px); }
        #btn-switch { background: rgba(0, 0, 0, 0.6); }
        #btn-natural { background: rgba(80, 80, 80, 0.6); transition: 0.3s; }
        #btn-natural.active { background: linear-gradient(45deg, #FF512F, #DD2476); border-color: #FFD700; box-shadow: 0 0 15px #FF512F; }

        #theme-toast {
            position: fixed; top: 40%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.85); color: #FFD700; padding: 30px 50px; border-radius: 20px; border: 3px solid #FFD700;
            font-size: 32px; font-weight: bold; text-align: center; display: none; z-index: 1500;
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: translate(-50%, -50%) scale(0); } to { transform: translate(-50%, -50%) scale(1); } }

        #quiz-box { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            z-index: 1600; background: white; padding: 25px; border-radius: 20px; 
            display: none; width: 90%; max-width: 400px; text-align: center; box-shadow: 0 20px 50px rgba(0,0,0,0.5); pointer-events: auto;
        }
        .option-btn { display: block; width: 100%; margin: 10px 0; padding: 12px; background: #f0f0f0; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; cursor: pointer; text-align: left; }
        #result-msg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); color: white; display: none; z-index: 1700; flex-direction: column; justify-content: center; align-items: center; text-align: center; padding: 20px; pointer-events: auto; }
    </style>
</head>
<body>

<div id="home-screen">
    <h1 style="font-size: 2.5em;">AR ç”Ÿæ…‹æ¢éšª</h1>
    <p style="opacity: 0.8; margin-bottom: 30px;">ç’°å¢ƒæ•™è‚²å°æŠ—è³½ [cite: 1]</p>
    <button class="btn" onclick="toggleInstructions(true)" style="background: #FF9800; color: white; padding: 12px 40px; font-size: 18px; margin-bottom: 20px;">ğŸ“– éŠæˆ²è¦å‰‡èˆ‡æ ¼å­èªªæ˜</button>
    <button id="init-btn" class="btn" style="padding: 15px 50px; font-size: 22px; background: white; color: #333;" disabled>è¼‰å…¥ä¸­...</button>
</div>

<div id="instruction-modal">
    <h3>ğŸ“– éŠæˆ²è©³ç´°è¦å‰‡</h3>
    <hr>
    <p><b>1. åŸºæœ¬ç©æ³•ï¼š</b> é›™æ–¹è¼ªæµæŠ•æ“²éª°å­ï¼Œä¾é»æ•¸ç§»å‹•æ£‹å­ã€‚è‹¥ç‡å…ˆç´¯ç©é” <b>50 åˆ†</b> å³ç²å‹ï¼ </p>
    <p><b>2. æ ¼å­ä½œç”¨èªªæ˜ï¼š</b></p>
    <ul>
        <li><b>ç ´å£äº‹ä»¶æ ¼ï¼š</b> å¿…é ˆå¾ã€Œç ´å£å¡ã€ä¸­æŠ½ä¸€å¼µæƒæã€‚</li>
        <li><b>ä¿è‚²äº‹ä»¶æ ¼ï¼š</b> å¿…é ˆå¾ã€Œä¿è‚²å¡ã€ä¸­æŠ½ä¸€å¼µæƒæã€‚</li>
        <li><b>å¤©æ“‡äº‹ä»¶æ ¼ï¼š</b> é ˆå…ˆé»æ“Šè¢å¹•ä¸Šçš„<b>ã€Œå¤©æ“‡æŒ‰éˆ•ã€</b>ï¼Œéš¨å¾Œç”±å°æ‰‹åœ¨æ‰€æœ‰å¡ç‰‡ä¸­å¹«ä½ é¸ä¸€å¼µæƒæã€‚ </li>
        <li><b>ç›£ç„æ ¼ï¼š</b> è¸©åˆ°å¾Œç«‹å³åœæ­¢ï¼Œä¸‹å›åˆä¸å¯ç§»å‹•æ£‹å­ï¼Œä¸”è©²å›åˆé ˆç›´æ¥æŒ‰ä¸‹<b>ã€Œå¼·åˆ¶æ›äººã€</b>æŒ‰éˆ•ã€‚</li>
        <li><b>ç©ºæ ¼ï¼š</b> ç„¡æ³•åŸ·è¡Œä»»ä½•è¡Œå‹•ï¼Œè«‹ç›´æ¥æŒ‰ä¸‹<b>ã€Œå¼·åˆ¶æ›äººã€</b>åˆ‡æ›å›åˆã€‚</li>
    </ul>
    <p><b>3. è¨ˆåˆ†è¦å‰‡ï¼š</b></p>
    <ul>
        <li><b>ç ´å£å¡ï¼š</b> ç­”å°æ‰£æ•µæ–¹ 10 åˆ†ï¼›ç­”éŒ¯æ‰£å·±æ–¹ 10 åˆ†ã€‚ </li>
        <li><b>ä¿è‚²å¡ï¼š</b> ç­”å°åŠ å·±æ–¹ 10 åˆ†ï¼›ç­”éŒ¯ä¸æ‰£åˆ†ã€‚ </li>
        <li><b>å¤©æ“‡æ¨¡å¼ä¸‹ï¼š</b> æ‰€æœ‰å¡ç‰‡çš†è¦–ç‚ºç ´å£å¡ï¼Œä¸”<b>åŠ æ‰£åˆ†çš†è®Šç‚º 2 å€</b>ï¼ˆç­”å°æ‰£æ•µæ–¹ 20 åˆ†ï¼Œç­”éŒ¯æ‰£è‡ªå·± 20 åˆ†ï¼‰ã€‚</li>
    </ul>
    <button class="btn" onclick="toggleInstructions(false)" style="background: #2c3e50; color: white; width: 100%; padding: 12px;">æº–å‚™å¥½äº†ï¼</button>
</div>

<div id="team-select-modal">
    <h2>æ±ºå®šå…ˆæ‰‹</h2>
    <button class="btn team-btn btn-blue" onclick="startGame('blue')">è—æ–¹å…ˆæ”»</button>
    <button class="btn team-btn btn-red" onclick="startGame('red')">ç´…æ–¹å…ˆæ”»</button>
</div>

<div id="ui-layer">
    <div id="score-blue-box" class="score-board"><span>è—æ–¹</span><span id="score-blue" class="big-score">0</span></div>
    <div id="score-red-box" class="score-board"><span>ç´…æ–¹</span><span id="score-red" class="big-score">0</span></div>
    <div id="turn-banner">æº–å‚™ä¸­...</div>
    <div id="control-panel">
        <button id="btn-switch" class="btn ctrl-btn" onclick="manualNextTurn()">ğŸ”„ å¼·åˆ¶æ›äºº</button>
        <button id="btn-natural" class="btn ctrl-btn" onclick="toggleNaturalSelection()">âš¡ å¤©æ“‡æ¨¡å¼ <span id="ns-status">OFF</span></button>
    </div>
</div>

<div id="theme-toast">ä¸»é¡Œåç¨±</div>
<div id="quiz-box">
    <h3 id="q-category"></h3>
    <h2 id="q-title"></h2>
    <p id="q-text"></p>
    <div id="q-options"></div>
</div>

<div id="result-msg">
    <h1 id="res-title"></h1>
    <h3 id="res-score"></h3>
    <p id="res-detail"></p>
    <button id="res-btn" class="btn" style="background: white; color: black; padding: 15px 40px; margin-top: 30px;" onclick="nextTurn()">æ›å°æ–¹å›åˆ</button>
</div>

<a-scene mindar-image="imageTargetSrc: ./targets.mind; autoStart: false; filterMinCF:0.001; filterBeta:0.01;" color-space="sRGB" renderer="colorManagement: true, physicallyCorrectLights" vr-mode-ui="enabled: false" device-orientation-permission-ui="enabled: false">
    <a-assets>
        <video id="v0" src="./videos/v0.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v1" src="./videos/v1.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v2" src="./videos/v2.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v3" src="./videos/v3.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v4" src="./videos/v4.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v5" src="./videos/v5.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v6" src="./videos/v6.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v7" src="./videos/v7.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v8" src="./videos/v8.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
        <video id="v9" src="./videos/v9.mp4" playsinline webkit-playsinline muted crossorigin="anonymous"></video>
    </a-assets>
    <a-camera position="0 0 0" look-controls="enabled: false"></a-camera>
    <script>
        const scene = document.querySelector('a-scene');
        for (let i = 0; i < 10; i++) {
            const target = document.createElement('a-entity');
            target.setAttribute('mindar-image-target', `targetIndex: ${i}`);
            target.id = `marker${i}`;
            const vp = document.createElement('a-video');
            vp.setAttribute('src', `#v${i}`);
            vp.setAttribute('width', '1'); vp.setAttribute('height', '0.75');
            target.appendChild(vp);
            scene.appendChild(target);
        }
    </script>
</a-scene>

<script>
    let scores = { blue: 0, red: 0 }, currentTurn = '', isLocked = false, isGameOver = false, isNaturalSelection = false;
    const quizDatabase = [
        { name: "éåº¦æ•æ’ˆ", type: "D", used: [], q: [{ t: "å“ªç¨®æ•é­šæ–¹å¼æœ€å®¹æ˜“ç ´å£æµ·åº•æ£²åœ°ï¼Ÿ", o: ["åº•æ‹–ç¶²", "ä¸€æ”¯é‡£", "å®šç½®ç¶²", "å‚é‡£"], a: 0 }, { t: "ã€Œæ··ç²ã€æ˜¯æŒ‡ä»€éº¼ï¼Ÿ", o: ["æ„å¤–æ•ç²éç›®æ¨™ç‰©ç¨®", "æ··åˆå¤šç¨®é­šé¡è²©è³£", "ä½¿ç”¨æ··åˆé¤Œæ–™", "æ··æ°´æ‘¸é­š"], a: 0 }, { t: "ç‚ºäº†æ°¸çºŒæµ·æ´‹ï¼Œæˆ‘å€‘æ‡‰è©²é¿å…è³¼è²·ï¼Ÿ", o: ["ç€•å±é­šç¨®", "é¤Šæ®–å³éƒ­é­š", "å¸¸è¦‹çš„ç§‹åˆ€é­š", "è›¤èœŠ"], a: 0 }, { t: "å¤§é‡æ•æ’ˆå°å‹é­šé¡æœƒé€ æˆä»€éº¼å¾Œæœï¼Ÿ", o: ["å¤§å‹é­šé¡é£Ÿç‰©çŸ­ç¼º", "æµ·æ°´è®Šé¹¹", "æµ·è—»æ¸›å°‘", "çŠç‘šç™½åŒ–"], a: 0 }, { t: "ä»¥ä¸‹ä½•è€…æ˜¯æ°¸çºŒæµ·é®®çš„åŸå‰‡ï¼Ÿ", o: ["åº•é£ŸåŸå‰‡(åƒåº•å±¤ç”Ÿç‰©)", "åªåƒé­šç¿…", "å°ˆæŒ‘ç¨€æœ‰é­š", "é£Ÿç”¨æœªæˆç†Ÿå¹¼é­š"], a: 0 }] },
        { name: "æ¿«ç æ¿«ä¼", type: "D", used: [], q: [{ t: "æ£®æ—ç ä¼æœƒç›´æ¥å°è‡´å“ªç¨®æ°£é«”å¢åŠ ï¼Ÿ", o: ["äºŒæ°§åŒ–ç¢³", "æ°§æ°£", "æ°®æ°£", "æ°«æ°£"], a: 0 }, { t: "æ¨¹æœ¨æ ¹éƒ¨çš„ä¸»è¦åŠŸèƒ½ä¸åŒ…å«ï¼Ÿ", o: ["å¸å¼•é›·é›»", "æŠ“ç·ŠåœŸå£¤", "å¸æ”¶æ°´åˆ†", "é˜²æ­¢åœŸçŸ³æµ"], a: 0 }, { t: "é›¨æ—è¢«ç¨±ç‚ºåœ°çƒçš„ä»€éº¼ï¼Ÿ", o: ["åœ°çƒä¹‹è‚º", "åœ°çƒä¹‹è…", "åœ°çƒä¹‹å¿ƒ", "åœ°çƒä¹‹çœ¼"], a: 0 }, { t: "ç ä¼æ£®æ—å¾Œç¨®æ¤å–®ä¸€ä½œç‰©(å¦‚æ²¹æ£•)ï¼Œæœƒå°è‡´ï¼Ÿ", o: ["ç”Ÿç‰©å¤šæ¨£æ€§é™ä½", "ç”Ÿæ…‹æ›´è±å¯Œ", "åœŸå£¤æ›´è‚¥æ²ƒ", "å‹•ç‰©æ›´å¿«æ¨‚"], a: 0 }, { t: "æ£®æ—æ¶ˆå¤±å°æ°´å¾ªç’°çš„å½±éŸ¿ï¼Ÿ", o: ["é™é›¨èª¿ç¯€èƒ½åŠ›è®Šå·®", "é›¨æ°´è®Šå¤š", "æ²³æ°´è®Šæ¸…æ¾ˆ", "æ²’æœ‰å½±éŸ¿"], a: 0 }] },
        { name: "å·¥æ¥­æ±¡æŸ“", type: "D", used: [], q: [{ t: "å·¥å» å»¢æ°´ç›´æ¥æ’å…¥æ²³å·æœƒå°è‡´ï¼Ÿ", o: ["å„ªé¤ŠåŒ–èˆ‡ç”Ÿç‰©æ­»äº¡", "æ²³æ°´è®Šå¥½å–", "é­šé¡é•·å¾—æ›´å¤§", "å¢åŠ ç¤¦ç‰©è³ª"], a: 0 }, { t: "ã€Œç”Ÿç‰©æ”¾å¤§ä½œç”¨ã€æ˜¯æŒ‡é‡é‡‘å±¬åœ¨å“ªå€‹éšå±¤æ¿ƒåº¦æœ€é«˜ï¼Ÿ", o: ["é«˜ç´šæ¶ˆè²»è€…(å¦‚äººé¡)", "ç”Ÿç”¢è€…(è—»é¡)", "åˆç´šæ¶ˆè²»è€…(å°è¦)", "æ²³æ°´æœ¬èº«"], a: 0 }, { t: "ç‡ƒç‡’ç…¤ç‚­ç”¢ç”Ÿçš„ç¡«æ°§åŒ–ç‰©æœƒé€ æˆï¼Ÿ", o: ["é…¸é›¨", "å½©è™¹", "åœ°éœ‡", "æµ·å˜¯"], a: 0 }, { t: "PM2.5 æ˜¯æŒ‡ä»€éº¼ï¼Ÿ", o: ["ç´°æ‡¸æµ®å¾®ç²’", "ä¸‹åˆ2é»åŠ", "ä¸€ç¨®ç¶­ç”Ÿç´ ", "æ–°å‹æ©Ÿå™¨äºº"], a: 0 }, { t: "è™•ç†å·¥æ¥­å»¢æ°´çš„æ­£ç¢ºæ–¹å¼ï¼Ÿ", o: ["ç¶“éæ±¡æ°´è™•ç†å» æ·¨åŒ–", "è¶åŠå¤œå·æ’", "åŠ æ°´ç¨€é‡‹å°±å¥½", "æ’å…¥åœ°ä¸‹æ°´"], a: 0 }] },
        { name: "å¤–ä¾†ç¨®å…¥ä¾µ", type: "D", used: [], q: [{ t: "å¤–ä¾†ç¨®ä¹‹æ‰€ä»¥æœƒæ°¾æ¿«ï¼Œé€šå¸¸æ˜¯å› ç‚ºï¼Ÿ", o: ["ç¼ºä¹å¤©æ•µ", "é©æ‡‰åŠ›å·®", "é•·å¾—å¯æ„›", "å£½å‘½å¾ˆçŸ­"], a: 0 }, { t: "åœ¨å°ç£ï¼Œå“ªç¨®ç”Ÿç‰©æ˜¯è‘—åçš„å¤–ä¾†å…¥ä¾µç¨®ï¼Ÿ", o: ["ç¦å£½èº", "å°ç£é»‘ç†Š", "æ«»èŠ±é‰¤å»é®­", "å°ç£è—éµ²"], a: 0 }, { t: "éš¨æ„æ”¾ç”Ÿå¯µç‰©(å¦‚å·´è¥¿é¾œ)æœƒé€ æˆï¼Ÿ", o: ["ç ´å£æœ¬åœŸç”Ÿæ…‹", "å¢åŠ ç”Ÿç‰©å¤šæ¨£æ€§", "è®“çƒé¾œæ›´è‡ªç”±", "æ”¹å–„æ°´è³ª"], a: 0 }, { t: "ã€Œå°èŠ±è”“æ¾¤è˜­ã€è¢«ç¨±ç‚ºä»€éº¼ï¼Ÿ", o: ["ç¶ è‰²æ®ºæ‰‹", "æ£®æ—å…¬ä¸»", "ç¶ è‰²å¯¶çŸ³", "çˆ¬è—¤å°ˆå®¶"], a: 0 }, { t: "é˜²æ²»å¤–ä¾†ç¨®æœ€æœ‰æ•ˆçš„æ–¹æ³•æ˜¯ï¼Ÿ", o: ["æºé ­ç®¡åˆ¶ä¸éš¨æ„å¼•å…¥", "å¤§é‡å™´ç‘è¾²è—¥", "è¨“ç·´æœ¬åœŸç”Ÿç‰©æˆ°é¬¥", "ä¸ç†æœƒ"], a: 0 }] },
        { name: "æ°£å€™è®Šé·", type: "D", used: [], q: [{ t: "é€ æˆå…¨çƒæš–åŒ–çš„ä¸»è¦æº«å®¤æ°£é«”æ˜¯ï¼Ÿ", o: ["CO2 (äºŒæ°§åŒ–ç¢³)", "O2 (æ°§æ°£)", "N2 (æ°®æ°£)", "He (æ°¦æ°£)"], a: 0 }, { t: "æ°£å€™è®Šé·å°è‡´æ¥µåœ°å†°èï¼Œå“ªç¨®å‹•ç‰©å—å®³æœ€æ·±ï¼Ÿ", o: ["åŒ—æ¥µç†Š", "é§±é§", "ç…å­", "ç„¡å°¾ç†Š"], a: 0 }, { t: "æµ·æ°´æº«åº¦ä¸Šå‡æœƒå°è‡´çŠç‘šç”¢ç”Ÿä»€éº¼ç¾è±¡ï¼Ÿ", o: ["ç™½åŒ–", "ç´…åŒ–", "è®Šç¡¬", "ç™¼å…‰"], a: 0 }, { t: "æ¥µç«¯æ°£å€™ä¸åŒ…å«ä¸‹åˆ—ä½•è€…ï¼Ÿ", o: ["æ¯å¤©æº–æ™‚ä¸‹é›¨", "è¶…å¼·é¢±é¢¨", "é•·æœŸä¹¾æ—±", "ç•°å¸¸ç†±æµª"], a: 0 }, { t: "æ¸›ç·©æ°£å€™è®Šé·æˆ‘å€‘å¯ä»¥åšä»€éº¼ï¼Ÿ", o: ["ç¯€èƒ½æ¸›ç¢³", "24å°æ™‚é–‹å†·æ°£", "å¤šåƒç‰›è‚‰", "ç ä¼æ¨¹æœ¨"], a: 0 }] },
        { name: "æ£²åœ°å¾©è‚²", type: "C", used: [], q: [{ t: "å¾©è‚²æ£®æ—æ™‚ï¼Œæœ€å¥½ç¨®æ¤ï¼Ÿ", o: ["åŸç”Ÿç¨®æ¤ç‰©", "å¤–ä¾†ç¨®è§€è³èŠ±", "å–®ä¸€æ¨¹ç¨®", "å¡‘è† æ¨¹"], a: 0 }, { t: "ã€Œç”Ÿæ…‹å»Šé“ã€çš„åŠŸèƒ½æ˜¯ï¼Ÿ", o: ["é€£çµç ´ç¢æ£²åœ°å¹«åŠ©å‹•ç‰©é·å¾™", "çµ¦äººé¡æ•£æ­¥", "è£é£¾é«˜é€Ÿå…¬è·¯", "é˜²æ­¢å™ªéŸ³"], a: 0 }, { t: "æ¿•åœ°å¾©è‚²çš„ä¸»è¦å¥½è™•ä¸åŒ…å«ï¼Ÿ", o: ["å¢åŠ èšŠèŸ²", "æ·¨åŒ–æ°´è³ª", "æä¾›é³¥é¡æ£²æ¯", "é˜²æ´ª"], a: 0 }, { t: "å¾©è‚²è¢ç«èŸ²éœ€è¦ä»€éº¼æ¨£çš„ç’°å¢ƒï¼Ÿ", o: ["ä¹¾æ·¨ç„¡å…‰å®³çš„æ°´åŸŸ", "ç†±é¬§çš„å…¬åœ’", "å……æ»¿è¾²è—¥çš„ç”°", "è·¯ç‡ˆä¸‹"], a: 0 }, { t: "äººå·¥é­šç¤çš„åŠŸèƒ½æ˜¯ï¼Ÿ", o: ["æä¾›é­šé¡èº²è—èˆ‡æ£²æ¯", "ä¸Ÿæ£„å»¢æ£„ç‰©", "é˜»æ“‹èˆ¹éš»", "ç¾è§€"], a: 0 }] },
        { name: "è³‡æºå›æ”¶", type: "C", used: [], q: [{ t: "å“ªç¨®æ¨™èªŒä»£è¡¨è³‡æºå›æ”¶ï¼Ÿ", o: ["ä¸‰å€‹å¾ªç’°ç®­é ­", "ç´…è‰²åå­—", "é»ƒè‰²é–ƒé›»", "ç¶ è‰²æ„›å¿ƒ"], a: 0 }, { t: "æ¸…æ´—å›æ”¶ç‰©çš„ä¸»è¦ç›®çš„æ˜¯ï¼Ÿ", o: ["é¿å…ç™¼è‡­èˆ‡å­³ç”ŸèšŠèŸ²", "è®“å›æ”¶é˜¿å§¨é–‹å¿ƒ", "å¢åŠ é‡é‡", "å¹«åƒåœ¾æ´—æ¾¡"], a: 0 }, { t: "å»¢é›»æ± æ‡‰è©²å¦‚ä½•è™•ç†ï¼Ÿ", o: ["å›æ”¶è‡³å°ˆå±¬å›æ”¶ç­’", "ä¸Ÿä¸€èˆ¬åƒåœ¾", "åŸ‹åœ¨åœŸè£¡", "ç‡’æ‰"], a: 0 }, { t: "å»šé¤˜å›æ”¶å¯ä»¥ç”¨ä¾†åšä»€éº¼ï¼Ÿ", o: ["å †è‚¥æˆ–é¤Šè±¬", "åšæˆé¤…ä¹¾", "é‹ªè·¯", "è“‹æˆ¿å­"], a: 0 }, { t: "æ¸›å°‘ä½¿ç”¨å¡‘è† å¸ç®¡æ˜¯ç‚ºäº†ä¿è­·å“ªç¨®å‹•ç‰©ï¼Ÿ", o: ["æµ·é¾œ", "è€é·¹", "èš¯èš“", "æ¾é¼ "], a: 0 }] },
        { name: "å†ç”Ÿèƒ½æº", type: "C", used: [], q: [{ t: "ä¸‹åˆ—ä½•è€…å±¬æ–¼å†ç”Ÿèƒ½æºï¼Ÿ", o: ["å¤ªé™½èƒ½", "ç…¤ç‚­", "çŸ³æ²¹", "å¤©ç„¶æ°£"], a: 0 }, { t: "å°ç£è¥¿éƒ¨æ²¿æµ·å¸¸è¦‹çš„ç™½è‰²å·¨å¤§é¢¨æ‰‡æ˜¯ï¼Ÿ", o: ["é¢¨åŠ›ç™¼é›»æ©Ÿ", "è¶…å¤§é›»é¢¨æ‰‡", "è£ç½®è—è¡“", "è¶•é³¥å™¨"], a: 0 }, { t: "ä½¿ç”¨å†ç”Ÿèƒ½æºçš„æœ€å¤§å„ªé»ï¼Ÿ", o: ["æ¸›å°‘ç¢³æ’æ”¾", "å®Œå…¨ä¸èŠ±éŒ¢", "è£½é€ æ›´å¤šåƒåœ¾", "éš¨æ™‚éƒ½æœ‰é›»"], a: 0 }, { t: "ç”Ÿè³ªèƒ½é€šå¸¸ä¾†è‡ªï¼Ÿ", o: ["å‹•æ¤ç‰©æœ‰æ©Ÿå»¢æ£„ç‰©", "çŸ³é ­", "é‡‘å±¬", "ç»ç’ƒ"], a: 0 }, { t: "åœ°ç†±ç™¼é›»æ˜¯åˆ©ç”¨åœ°çƒå…§éƒ¨çš„ä»€éº¼ï¼Ÿ", o: ["ç†±èƒ½", "ç£åŠ›", "é‡åŠ›", "æ—‹è½‰"], a: 0 }] },
        { name: "ç”Ÿç‰©å¤šæ¨£æ€§", type: "C", used: [], q: [{ t: "ç”Ÿç‰©å¤šæ¨£æ€§é«˜çš„å¥½è™•æ˜¯ï¼Ÿ", o: ["ç”Ÿæ…‹ç³»çµ±è¼ƒç©©å®š", "ç’°å¢ƒæ¯”è¼ƒé«’äº‚", "å‹•ç‰©å®¹æ˜“æ‰“æ¶", "æ²’æœ‰å¥½è™•"], a: 0 }, { t: "å°ç£ç‰¹æœ‰ç¨®ã€ŒçŸ³è™ã€é¢è‡¨çš„æœ€å¤§å±æ©Ÿï¼Ÿ", o: ["è·¯æ®ºèˆ‡æ£²åœ°å–ªå¤±", "è¢«æŠ“å»å‹•ç‰©åœ’", "é£Ÿç‰©å¤ªå¤š", "å¤©æ°£å¤ªç†±"], a: 0 }, { t: "ä¿è­·èœœèœ‚ç‚ºä»€éº¼å¾ˆé‡è¦ï¼Ÿ", o: ["å¹«å¿™è¾²ä½œç‰©æˆç²‰", "å¯ä»¥åƒèœ‚èœœ", "èœœèœ‚å¾ˆå¯æ„›", "é‡å¯ä»¥ç”¨ä¾†é‡ç¸"], a: 0 }, { t: "ä¸‹åˆ—å“ªå€‹åœ°æ–¹çš„ç”Ÿç‰©å¤šæ¨£æ€§é€šå¸¸æœ€é«˜ï¼Ÿ", o: ["ç†±å¸¶é›¨æ—", "æ²™æ¼ ", "åŒ—æ¥µ", "æ°´æ³¥åŸå¸‚"], a: 0 }, { t: "åŸºå› å¤šæ¨£æ€§é«˜ä»£è¡¨ï¼Ÿ", o: ["ç‰©ç¨®è¼ƒèƒ½æŠµæŠ—ç–¾ç—…", "ç‰©ç¨®å®¹æ˜“æ»…çµ•", "å¤§å®¶é•·å¾—ä¸€æ¨¡ä¸€æ¨£", "å®¹æ˜“ç”Ÿç—…"], a: 0 }] },
        { name: "æ°´è³‡æºä¿è­·", type: "C", used: [], q: [{ t: "æ´—ç±³æ°´å¯ä»¥ç”¨ä¾†ï¼Ÿ", o: ["æ¾†èŠ±", "æ´—è»Š", "æ´—æ¾¡", "ç›´æ¥å€’æ‰"], a: 0 }, { t: "å°ç£é›–ç„¶é›¨é‡å¤šï¼Œå»ç¼ºæ°´çš„åŸå› ï¼Ÿ", o: ["åœ°å‹¢é™¡å³­æ°´æµå¿«", "å¤§å®¶ä¸æ„›å–æ°´", "è’¸ç™¼å¤ªå¿«", "æ°´è¢«å·èµ°äº†"], a: 0 }, { t: "é¸è³¼æ´—è¡£æ©Ÿæ™‚ï¼Œæ‡‰èªæ˜ä»€éº¼æ¨™ç« ï¼Ÿ", o: ["çœæ°´æ¨™ç« ", "å„ªè‰¯é£Ÿå“", "æ­£å­—æ¨™è¨˜", "CAS"], a: 0 }, { t: "ä¿è­·æ²³å·ä¸Šæ¸¸æ£®æ—çš„ä¸»è¦åŠŸèƒ½ï¼Ÿ", o: ["æ¶µé¤Šæ°´æº", "ç¨®é«˜å±±é«˜éº—èœ", "è“‹è±ªè¯æ°‘å®¿", "å€’åƒåœ¾"], a: 0 }, { t: "ç”Ÿæ´»æ±¡æ°´ä¸­ï¼Œå“ªç¨®æ±è¥¿æœ€å®¹æ˜“æ±¡æŸ“æ°´æºï¼Ÿ", o: ["å«ç£·æ¸…æ½”åŠ‘", "æ´—ç±³æ°´", "èŒ¶è‘‰æ¸£", "æœçš®"], a: 0 }] }
    ];

    window.onload = function() {
        const checkReady = setInterval(() => {
            if (typeof AFRAME !== 'undefined' && document.querySelector('a-scene').hasLoaded) {
                clearInterval(checkReady);
                document.getElementById('init-btn').innerText = "é»æ“Šé–‹å•Ÿ"; document.getElementById('init-btn').disabled = false;
                document.getElementById('init-btn').style.background = "#4CAF50"; document.getElementById('init-btn').style.color = "white";
                document.getElementById('init-btn').onclick = () => { document.getElementById('home-screen').style.display = 'none'; document.getElementById('team-select-modal').style.display = 'flex'; };
            }
        }, 500);
    };

    function toggleInstructions(show) { document.getElementById('instruction-modal').style.display = show ? 'block' : 'none'; }
    
    // ä¿®æ­£æ”å½±æ©Ÿå®šæ ¼ï¼šç§»é™¤ confirmï¼Œç›´æ¥æ›äºº
    function manualNextTurn() {
        for(let i=0; i<10; i++) { const v = document.getElementById(`v${i}`); if(v && !v.paused) v.pause(); }
        document.getElementById('theme-toast').style.display = 'none';
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('result-msg').style.display = 'none';
        nextTurn();
    }

    function toggleNaturalSelection() {
        isNaturalSelection = !isNaturalSelection;
        const btn = document.getElementById('btn-natural'), status = document.getElementById('ns-status');
        if (isNaturalSelection) { btn.classList.add('active'); status.innerText = "ON"; } 
        else { btn.classList.remove('active'); status.innerText = "OFF"; }
    }

    async function startGame(team) {
        currentTurn = team; updateTurnUI();
        const sceneEl = document.querySelector('a-scene');
        try {
            await sceneEl.systems["mindar-image-system"].start();
            document.getElementById('team-select-modal').style.display = 'none';
            document.getElementById('ui-layer').style.display = 'block';
            bindMarkers();
        } catch (e) { alert("å•Ÿå‹•å¤±æ•—"); }
    }

    function updateTurnUI() {
        const banner = document.getElementById('turn-banner');
        banner.innerText = `ç¾åœ¨å›åˆï¼š${currentTurn === 'blue' ? 'è—æ–¹' : 'ç´…æ–¹'}`;
        banner.style.background = currentTurn === 'blue' ? "#4b6cb7" : "#D31027";
    }

    function bindMarkers() {
        for (let i = 0; i < 10; i++) {
            const m = document.getElementById(`marker${i}`);
            m.addEventListener("targetFound", () => handleScan(i));
            m.addEventListener("targetLost", () => { const v = document.getElementById(`v${i}`); if(v) v.pause(); });
        }
    }

    function handleScan(index) {
        if (isLocked || isGameOver) return;
        const video = document.getElementById(`v${index}`); video.play();
        const card = quizDatabase[index], toast = document.getElementById('theme-toast');
        toast.innerHTML = isNaturalSelection ? `âš¡ ${card.name} âš¡<br>å¤©æ“‡åŠ å€` : card.name;
        toast.style.display = 'block'; toast.style.animation = 'none'; toast.offsetHeight; toast.style.animation = 'popIn 0.5s';
        setTimeout(() => { if (!isLocked && !isGameOver) { isLocked = true; video.pause(); toast.style.display = 'none'; showQuestion(index); } }, 5000);
    }

    function showQuestion(cardIndex) {
        const card = quizDatabase[cardIndex];
        let available = card.q.map((_, i) => i).filter(i => !card.used.includes(i));
        if (available.length === 0) { card.used = []; available = card.q.map((_, i) => i); }
        const qData = card.q[available[Math.floor(Math.random() * available.length)]];
        card.used.push(quizDatabase[cardIndex].q.indexOf(qData));
        let options = qData.o.map((txt, idx) => ({ txt, isCorrect: idx === 0 }));
        options.sort(() => Math.random() - 0.5);
        document.getElementById('quiz-box').style.display = 'block';
        document.getElementById('q-category').innerText = isNaturalSelection ? "ã€å¤©æ“‡ï¼šå¼·åˆ¶ç ´å£ x2ã€‘" : (card.type === 'D' ? "ã€ç ´å£å¡ã€‘" : "ã€ä¿è‚²å¡ã€‘");
        document.getElementById('q-category').style.color = (isNaturalSelection || card.type === 'D') ? "#D31027" : "#4CAF50";
        document.getElementById('q-title').innerText = card.name; document.getElementById('q-text').innerText = qData.t;
        const area = document.getElementById('q-options'); area.innerHTML = '';
        options.forEach(opt => { const b = document.createElement('button'); b.className = 'option-btn'; b.innerText = opt.txt; b.onclick = () => handleAnswer(opt.isCorrect, card.type); area.appendChild(b); });
    }

    function handleAnswer(isCorrect, originalType) {
        document.getElementById('quiz-box').style.display = 'none';
        let type = isNaturalSelection ? 'D' : originalType, points = isNaturalSelection ? 20 : 10;
        let title = "", scoreText = "", detail = "";
        if (type === 'D') {
            if (isCorrect) { title = "ğŸ‰ æˆåŠŸï¼"; if(currentTurn==='blue') scores.red-=points; else scores.blue-=points; scoreText=`æ•µæ–¹ -${points}`; }
            else { title = "ğŸ’¥ å¤±æ•—ï¼"; if(currentTurn==='blue') scores.blue-=points; else scores.red-=points; scoreText=`å·±æ–¹ -${points}`; }
        } else {
            if (isCorrect) { title = "ğŸŒ¿ æˆåŠŸï¼"; if(currentTurn==='blue') scores.blue+=points; else scores.red+=points; scoreText=`å·±æ–¹ +${points}`; }
            else { title = "ğŸ’¨ å¤±æ•—ï¼"; scoreText="+0"; }
        }
        document.getElementById('score-blue').innerText = scores.blue; document.getElementById('score-red').innerText = scores.red;
        document.getElementById('result-msg').style.display = 'flex';
        if (scores.blue >= 50 || scores.red >= 50) {
            isGameOver = true; document.getElementById('res-title').innerText = "ğŸ† éŠæˆ²çµæŸï¼";
            document.getElementById('res-score').innerText = `å‹è€…ï¼š${scores.blue>=50?'è—æ–¹':'ç´…æ–¹'}`;
            const b = document.getElementById('res-btn'); b.innerText = "é‡ç©"; b.onclick = () => location.reload();
        } else {
            document.getElementById('res-title').innerText = title; document.getElementById('res-score').innerText = scoreText;
            document.getElementById('res-btn').innerText = "æ›äºº"; document.getElementById('res-btn').onclick = nextTurn;
        }
    }

    function nextTurn() {
        document.getElementById('result-msg').style.display = 'none';
        if (isNaturalSelection) toggleNaturalSelection();
        currentTurn = currentTurn === 'blue' ? 'red' : 'blue';
        updateTurnUI(); isLocked = false;
    }
</script>
</body>
</html>